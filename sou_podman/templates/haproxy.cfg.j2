global
  maxconn 20000
  ulimit-n 16384
  log 127.0.0.1 local0 debug
  daemon

frontend fe_https
  bind *:8443 ssl crt /certificate.pem
  mode http
  log global
  option httplog
  option dontlognull
  option nolinger
  maxconn 8000
  timeout client 30s

  use_backend prometheus if { path /prometheus } or { path_beg /prometheus/ }
  use_backend grafana if { path /grafana } or { path_beg /grafana/ }

backend grafana
  mode http
  balance roundrobin
  option httpchk
  server grafana1 {{ grafana_container.name }}:3000 check

backend prometheus
  mode http
  balance roundrobin
  option httpchk
  server prometheus1 {{ prometheus_container.name }}:9090 check
